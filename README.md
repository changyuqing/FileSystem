# FileSystem

## Goal

- 用内存模拟磁盘，用结构体数组描述各不同的磁盘区域。磁盘的存取单元是磁盘块，一个盘块的大小是64字节。

- 磁盘布局

  | Inode-bitmap | Block-bitmap | Inode | block |
  | ------------ | ------------ | ----- | ----- |

- | **项目**   | **磁盘块个数** | **内容**                      |
  | -------- | --------- | --------------------------- |
  | 根目录      | 1         | 最多4个目录项                     |
  | I-node位图 | 1         | 描述512个i-node的状态             |
  | 数据块位图    | 2         | 描述1024个磁盘块状态                |
  | I-node   | 128       | I-node存储区，512个i-node，每个16字节 |
  | 数据块      | 1024      | 数据块存储区                      |

  - 每个目录项16个字节（在2.2中有具体定义），所以根目录下只允许建立4个子目录或者文件。
  - i-node位图1块64个字节，共512位，可以描述512个i-node的使用情况。
  - 位图的数据结构可以参考“**位域**”数据结构类型。
  - Data Block区的数据块，是三种类型。包括索引块，文本文件数据块，目录文件数据块。定义时使用**union类型**。

- 目录项

  | 文件或目录名 | 目录标志 | Inode编号 |
  | ------ | ---- | ------- |

  | 项目       | 字节数  | 内容                            |
  | -------- | ---- | ----------------------------- |
  | 文件或目录名   | 11   | 字符串，初始化为空                     |
  | 目录标志     | 1    | Unsigned char类型,0代表一般文件，1代表目录 |
  | I-node编号 | 4    | 整数类型，指向文件或者目录的索引节点            |

- i-node结构

  | 只读/隐藏/小时/分钟 | 直接盘快地址 | 直接盘快地址 | 一级索引块 |
  | ----------- | ------ | ------ | ----- |

  | **项目** | **字节数** | **内容**                    |
  | ------ | ------- | ------------------------- |
  | 是否只读   | 1       | Unsigned char             |
  | 是否隐藏   | 1       | Unsigned char             |
  | 小时     | 1       | Unsigned char 建立文件系统时间的小时 |
  | 分钟     | 1       | Unsigned char 建立文件系统时间的分钟 |
  | 直接盘块地址 | 4×2     | 整型，指向一个数据块                |
  | 一级索引地址 | 4       | 整型，指向一个索引块                |

- 文件

  文件有两种类型，目录文件及文本文件

  - **目录文件**

    由目录项构成的文件就是目录文件。目录项为16个字节长度。例如某个子目录有9个目录项（文件或下级子目录），那么这个目录文件将使用3个数据块（因为一个块64字节，只能存4个目录项）。那么这个目录文件的i-node，除了使用两个直接块，将使用到一级索引块，索引到另外一个数据块。

  - **文本文件**

    在本设计中，要求同学们可以创建文本文件将键盘输入的文本存到文件中。根据文本的实际长度决定使用多少个磁盘块来存储，以及是否使用到索引块。64个字符将使用一个数据块。


## Using

- Mkfile:在当前目录下新建文本文件

  ```c
  Mkfile  a.txt                 //新建a.txt文件，默认非只读，非隐藏
  ```

- Mkdir:在当前目录下新建目录文件, 

  ```c
  Mkdir  a                      //新建a目录，默认非只读，非隐藏
  ```

- Cd:改变当前目录：

  ```c
  Cd sub1                      //进入当前目录下的sub1子文件夹
  Cd ..                        // 返回上一级
  ```

- Delfile:删除文件

  ```c
  Delfiel a.txt                //删除当前目录下的a.txt
  ```

- Deldir:删除目录

  ```c
  Deldir a                    //删除当前目录下的a目录【a必须为空】
  ```

- Dir:列出当前目录下的文件信息

  ```c
  Dir                         //列出当前目录下的文件信息
  ```

- Copy:将当前目录下的一个文件拷贝到另一个目录下边,要拷贝到的目录用绝对地址表示

  ```c
  Copy a.txt root/sub1        //将a.txt拷贝到根目录下root/sub1下
  ```

- Open:打开文本文件

  ```c
  Open a.txt                  //将本目录下的a.txt打开,进行覆盖式修改
  ```

- Attrib:更改文件属性、

  ```c
  Attrib                          //显示当前目录下所有文件及其属性
  Attrib +r a.txt                // 将a.txt设置为只读
  Attrib -r a.txt                // 将a.txt设置为非只读
  Attrib +h a.txt                // 将a.txt设置为隐藏
  Attrib –h a.txt               // 将a.txt设置为非隐藏  
  ```
